<%- include('partials/header'); %>

<main class="flex items-center justify-center" style="height: calc(100vh - 64px);">
  <div class="w-full max-w-lg bg-white rounded-lg shadow-md p-8 -mt-16">
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-4">Upload Your CV</h2>
    <p class="text-center text-gray-500 mb-8">Accepted formats: PDF, DOCX, XLSX (Max 5MB)</p>

    <% if (success) { %>
      <div id="success-message" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
        <span class="block sm:inline"><%= success %></span>
      </div>
    <% } %>

    <% if (error) { %>
      <div id="error-message" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
        <span class="block sm:inline"><%= error %></span>
      </div>
    <% } %>

    <form action="/upload" method="POST" enctype="multipart/form-data">
      <div id="drop-zone" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500 transition-colors">
        <input type="file" name="cvFile" id="file-input" class="absolute w-0 h-0 p-0 m-0 border-0 opacity-0" accept=".pdf,.docx,.xlsx">
        <div id="drop-message">
          <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <p class="mt-2 text-sm text-gray-600">
            <span class="font-semibold">Click to upload</span> or drag and drop
          </p>
          <p id="file-name" class="mt-1 text-xs text-gray-500"></p>
        </div>
      </div>
      <div class="mt-6">
        <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full">
          Upload File
        </button>
      </div>
    </form>
  </div>
</main>

<script>
  const dropZone = document.getElementById('drop-zone');
  const fileInput = document.getElementById('file-input');
  const fileNameDisplay = document.getElementById('file-name');

  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(event =>
    [dropZone, document.body].forEach(el =>
      el.addEventListener(event, e => { e.preventDefault(); e.stopPropagation(); }, false)
    )
  );

  ['dragenter', 'dragover'].forEach(event =>
    dropZone.addEventListener(event, () => dropZone.classList.add('border-blue-500', 'bg-gray-50'), false)
  );

  ['dragleave', 'drop'].forEach(event =>
    dropZone.addEventListener(event, () => dropZone.classList.remove('border-blue-500', 'bg-gray-50'), false)
  );

  dropZone.addEventListener('drop', e => handleFiles(e.dataTransfer.files), false);
  dropZone.addEventListener('click', () => fileInput.click());
  fileInput.addEventListener('change', () => handleFiles(fileInput.files));

  function handleFiles(files) {
    if (files.length > 0) {
      fileInput.files = files;
      fileNameDisplay.textContent = `File selected: ${files[0].name}`;
    }
  }

  setTimeout(() => {
    const successMessage = document.getElementById('success-message');
    const errorMessage = document.getElementById('error-message');
    if (successMessage) successMessage.style.display = 'none';
    if (errorMessage) errorMessage.style.display = 'none';
  }, 5000);
</script>

<%- include('partials/footer'); %>
